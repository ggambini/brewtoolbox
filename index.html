<html>
	<head>
		<title>Brasserie Gamb - Mini boite a outils</title>
		<link rel="icon" type="image/x-icon" href="../template/brasserie-gamb_fav.ico" />
		<link href="brewtoolbox.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript">
			function getSG(gravity,unit) {
				gravity = parseFloat(gravity);
				var result;
				if(unit == "sg") {
					if(gravity > 500 && gravity < 2000) {
						gravity = gravity / 1000;
					}
					else if(gravity < 2 && gravity > 0) {
						gravity = gravity;
					}
					else {
						gravity = 1;
						alert('Syntax SG : [500-2000] OR [0.5-2.0]');
					}
					result = gravity;
				}
				else if(unit == "plato") {
					result = 1 + (gravity / (258.6 - 0.88 * gravity));
                                }
                                else if(unit == "brix") {
					gravity = 1.03 * gravity;
					result = 1 + (gravity / (258.6 - 0.88 * gravity));
                                }
				return result;
			}

			function getPlato(gravity,unit) {
				gravity = parseFloat(gravity);
                                var result;
                                if(unit == "sg") {
					if(gravity > 500 && gravity < 1500) {
                                                gravity = gravity / 1000;
                                        }
                                        else if(gravity < 2 && gravity > 0) {
                                                gravity = gravity;
                                        }
                                        else {
                                                gravity = 1;
                                                alert('getSG: ?');
                                        }
                                        result = (258.6 * (gravity - 1)) / (0.12 + 0.88 * gravity);
                                }
                                else if(unit == "plato") {
					result = gravity;
                                }
                                else if(unit == "brix") {
					result = 1.03 * gravity;
                                }
				return result;
                        }

			function getBrix(gravity,unit) {
				gravity = parseFloat(gravity);
                                var result;
                                if(unit == "sg") {
					if(gravity > 500 && gravity < 1500) {
                                                gravity = gravity / 1000;
                                        }
                                        else if(gravity < 2 && gravity > 0) {
                                                gravity = gravity;
                                        }
                                        else {
                                                gravity = 1;
                                                alert('getSG: ?');
                                        }
                                        result = ((258.6 * (gravity - 1)) / (0.12 + 0.88 * gravity)) / 1.03;
                                }
                                else if(unit == "plato") {
					result = gravity / 1.03;
                                }
                                else if(unit == "brix") {
					result = gravity;
                                }
				return result;
                        }

			function multiGravity() {
                        	var convertGravity = document.convertGravity.convertGravity.value;
				var convertUnit = document.convertGravity.convertUnit.value;
				var convertTemp = document.convertGravity.convertTemp.value;
				var adjustTemp = '20.0';

				document.getElementById('convertSG').innerHTML = getSG(convertGravity,convertUnit).toFixed(3);
				document.getElementById('convertPlato').innerHTML = getPlato(convertGravity,convertUnit).toFixed(2);
				document.getElementById('convertBrix').innerHTML = getBrix(convertGravity,convertUnit).toFixed(2);
				document.getElementById('convertTemp').innerHTML = document.convertGravity.convertTemp.value;
				
				var diffTemp = convertTemp - adjustTemp;
				var correction = ((0.00352871 * diffTemp * diffTemp) + (0.225225 * diffTemp)) /1000;
				var adjustedSG = correction + getSG(convertGravity,convertUnit);
		
				document.getElementById('adjustedSG').innerHTML = adjustedSG.toFixed(3); 
				document.getElementById('adjustedPlato').innerHTML = getPlato(adjustedSG, 'sg').toFixed(2);
				document.getElementById('adjustedBrix').innerHTML = getBrix(adjustedSG, 'sg').toFixed(2);
				document.getElementById('adjustTemp').innerHTML = adjustTemp;
                        }

			function apparentAttenuation() {
                               	var initialGravity = document.attenuation.initialGravity.value;
				var initialUnit = document.attenuation.initialUnit.value;
				var currentGravity = document.attenuation.currentGravity.value;
                                var currentUnit = document.attenuation.currentUnit.value;

				initialGravity = getSG(initialGravity,initialUnit);
				currentGravity = getSG(currentGravity,currentUnit);

				var appAttenuation = (initialGravity - currentGravity) / (initialGravity - 1) * 100;
				appAttenuation = appAttenuation.toFixed(2);
				document.getElementById('apparentAttenuation').innerHTML = appAttenuation + "%";

				var appAlcool = ((initialGravity - currentGravity) / 7.5) * 1000;
				appAlcool = appAlcool.toFixed(2);
				document.getElementById('alcool').innerHTML = appAlcool + "%";
                        }

			function decoctionTrempe() {
				var decoctionVolume = document.decoction.decoctionVolume.value;
				var decoctionInitial = document.decoction.decoctionInitial.value;
				var decoctionCible = document.decoction.decoctionCible.value; 
				var decoctionRetour = '100.0'

				decoctionRatio = (decoctionCible - decoctionInitial) / (decoctionRetour - decoctionInitial);
				decoctionTrempe = decoctionVolume * decoctionRatio;

				document.getElementById('decoctionTrempe').innerHTML = decoctionTrempe.toFixed(1) + "L";
				document.getElementById('decoctionRatio').innerHTML = ((decoctionRatio* 100).toFixed(1)) + "%";
			}

			function bavarianHopping() {
				var bavarianVolume = document.bavarianHopping.bavarianVolume.value;
				var bavarianAlpha = document.bavarianHopping.bavarianAlpha.value;
				var bavarianIBU = document.bavarianHopping.bavarianIBU.value;
				var bavarianRatio = document.bavarianHopping.bavarianRatio.value;

				var totalIBU = bavarianIBU * bavarianVolume;
				var totalHop = totalIBU / ((bavarianAlpha / 100) * bavarianRatio * 1000);
				var fwhHop = bavarianRatio * totalHop;
				var boilHop = (1 - bavarianRatio) * totalHop;

				document.getElementById('bavarianFWH').innerHTML = fwhHop;
				document.getElementById('bavarianBoil').innerHTML = boilHop;
			}
		</script>
	</head>
	<body>
	<div id="content">
		<img src="../template/brasserie-gamb_logo-v0.1.png" height=100 /><p/>
		<table width=100%>
			<tr valign="top">
				<td width=33%>
					<fieldset>
						<legend>Convertisseur</legend>
						<form name="convertGravity">
                                                        <input type="text" name="convertGravity" placeholder="Densité" value="1045" size="4"/>
                                                        <select name="convertUnit">
								<option value="sg">SG</option>
								<option value="plato">°P</option>
								<option value="brix">°B</option>
                                                        </select> @ 
                                                        <input type="text" name="convertTemp" placeholder="Temp" value="70.0" size="3"/>°C
							<input type="button" value="&circlearrowleft;" onClick="multiGravity()"/>
						</form>
						<p/>
						<table width=100%>
							<tr>
								<td width="25%">°C</td>
								<td width="25%">SG</td>
								<td width="25%">°P</td>
								<td width="25%">°B</td>
							</tr>
							<tr>
								<td id="convertTemp">-</td>
								<td id="convertSG">-</td>
								<td id="convertPlato">-</td>
								<td id="convertBrix">-</td>
							</tr>
							<tr>
								<td id="adjustTemp">20.0</td>
								<td id="adjustedSG">-</td>
								<td id="adjustedPlato">-</td>
								<td id="adjustedBrix">-</td>
							</tr>
						</table>
					</fieldset>
					<fieldset>
                                                <legend>Murica units convert</legend>
                                                <table width=100%>
							<tr>
								<td width="66%"><form>
									<input type="text" name="" placeholder="Temp" value="70.0" size="3"/>°F
								</form></td>
								<td>-</td>
							</tr>
							
						</table>
                                        </fieldset>
				</td>
				<td width=33%>
					<fieldset>
                                                <legend>Atténuation</legend>
						<form name="attenuation">
							<input type="text" name="initialGravity" placeholder="Initiale" value="11" size="4"/>
							<select name="initialUnit">
                                                                <option value="sg">SG</option>
                                                                <option value="plato" selected>°P</option>
                                                                <option value="brix">°B</option>
                                                        </select> &rarr; 
							<input type="text" name="currentGravity" placeholder="Actuelle" value="2" size="4"/>
                                                        <select name="currentUnit">
                                                                <option value="sg">SG</option>
                                                                <option value="plato" selected>°P</option>
                                                                <option value="brix">°B</option>
                                                        </select>
							<input type="button" value="&circlearrowleft;" onClick="apparentAttenuation()"/>
						</form>
						<p/>
						<table width="100%">
							<tr>
								<td width="66%">Atténuation apparente</td>
								<td id="apparentAttenuation">-</td>
							</tr>
							<tr>
								<td>Taux d'alcool</td>
                                                                <td id="alcool">-</td>
							</tr>
						</table>
                                        </fieldset>
					<fieldset>
                                                <legend>Bavarian Hopping</legend>
                                                <form name="bavarianHopping">
							<input type="text" name="bavarianVolume" placeholder="Volume" size="3" value="50"/>L 
                                                        <input type="text" name="bavarianAlpha" placeholder="Alpha" size="3" value="3.5"/>%AA &rarr;
                                                        <input type="text" name="bavarianIBU" placeholder="IBU" size="3" value="28"/>IBU 
							<input type="text" name="bavarianRatio" placeholder="Ratio" size="3" value="0.3"/>
                                                        <input type="button" value="&circlearrowleft;" onClick="bavarianHopping()"/>
						</form>
						<table width="100%">
                                                        <tr>
                                                                <td width="66%">First wort</td>
                                                                <td id="bavarianFWH">-</td>
                                                        </tr>
                                                        <tr>
                                                                <td>Ebullition</td>
                                                                <td id="bavarianBoil">-</td>
                                                        </tr>
                                                </table>
				</td>
				<td width=33%>
                                        <fieldset>
                                                <legend>Premier palier</legend>
						<form>
							<input type="text" placeholder="Grain" size="4"/>kg 
							<input type="text" placeholder="Ratio" size="3"/> &rarr;
							<input type="text" placeholder="Temp" size="3"/>°C
							<input type="button" value="&circlearrowleft;"/>
						</form>
						<table width="100%">
							<tr>
								<td>Volume eau</td>
								<td>x.xL</td>
							</tr>
							<tr>
								<td>Temp eau</td>
								<td>x.x°C</td>
							</tr>
						</table>
                                        </fieldset>
					<fieldset>
                                                <legend>Décoction</legend>
						<form name="decoction">
							<input type="text" name="decoctionVolume" placeholder="Volume" size="3" value="40"/>L@<input type="text" name="decoctionInitial" placeholder="Initiale" size="3" value="50"/>°C &rarr;
							<input type="text" name="decoctionCible" placeholder="Cible" size="3" value="65.0"/>°C
							<input type="button" value="&circlearrowleft;" onClick="decoctionTrempe()"/>
						</form>
						<table width="100%">
                                                        <tr>
                                                                <td width="66%">Volume trempe</td>
                                                                <td id="decoctionTrempe">-</td>
                                                        </tr>
                                                        <tr>
                                                                <td>Ratio</td>
                                                                <td id="decoctionRatio">-</td>
                                                        </tr>
                                                </table>
					</fieldset>
                                </td>
			</tr>
		</table>
	</div>
	</body>
</html>
